<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Panne de carburant – Exercice 4 (Test final)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    :root { --blue:#003b7a; --green:#009e60; --bg:#f4f6fb; --card-bg:#ffffff; --text:#222; --muted:#555; }
    body { font-family:Arial,sans-serif; background:var(--bg); margin:0; padding:0 0 40px; color:var(--text); }
    header {
        background:linear-gradient(90deg,var(--blue),var(--green));
        color:#fff;
        padding:15px 20px;
        display:flex;
        align-items:center;
        gap:15px;
        box-shadow:0 2px 6px rgba(0,0,0,0.25);
    }
    header img { height:55px; width:auto; border-radius:6px; background:#fff; padding:4px; }
    .header-text { display:flex; flex-direction:column; }
    .header-text h1 { margin:0; font-size:22px; }
    .header-text h2 { margin:4px 0 0; font-size:15px; opacity:0.9; }
    main { max-width:980px; margin:0 auto; padding:20px; }
    .section-title {
        color:var(--blue); font-size:20px; margin-top:25px; margin-bottom:10px;
        border-left:5px solid var(--blue); padding-left:10px;
    }
    .subtitle { font-size:14px; color:var(--muted); margin-bottom:8px; }
    .exercise {
        background:var(--card-bg); padding:16px 18px; border-radius:8px;
        margin-top:18px; box-shadow:0 2px 5px rgba(0,0,0,0.08); border-left:5px solid var(--green);
    }
    .drag-pool {
        display:flex;
        gap:8px;
        overflow-x:auto;
        padding:8px;
        background:#f1f3ff;
        border-radius:8px;
        border:1px solid #c9cdf0;
        margin-bottom:12px;
        white-space:nowrap;
    }
    .drag-item {
        display:inline-flex;
        align-items:center;
        gap:5px;
        background:#ffffff;
        border-radius:6px;
        padding:6px 8px;
        border:1px solid #ccd;
        cursor:grab;
        font-size:13px;
    }
    .drag-item button {
        font-size:11px;
        border:none;
        border-radius:12px;
        padding:3px 7px;
        cursor:pointer;
        background:var(--blue);
        color:#fff;
    }
    .questions {
        margin-top:10px;
    }
    .drop-zone {
        background:#eef1ff;
        border-radius:6px;
        padding:8px;
        min-height:42px;
        display:flex;
        align-items:center;
        justify-content:space-between;
        margin:6px 0;
        border:1px dashed #99a;
        font-size:14px;
    }
    .drop-label { flex:1; padding-right:8px; }
    .drop-content { min-width:150px; text-align:right; font-size:13px; color:#555; }
    .drop-zone.over { background:#dde6ff; border-color:#4b6fff; }
    .drop-zone.correct { background:#d6f5d6; border-color:#4CAF50; }
    .drop-zone.wrong { background:#f7cccc; border-color:#d9534f; }
    .btn {
        margin-top:10px; padding:7px 14px; background:var(--green);
        color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:14px;
    }
    .btn.secondary { background:#666; }
    .result-summary { margin-top:10px; font-size:14px; }
    .result-summary strong { font-size:16px; }
    .correction-block {
        margin-top:10px;
        padding:10px;
        background:#f5fff5;
        border-radius:6px;
        border:1px solid #c8e6c9;
        font-size:14px;
    }
    .nav-links { margin-top:20px; display:flex; flex-wrap:wrap; gap:10px; }
    .nav-links a {
        text-decoration:none; background:var(--blue); color:#fff;
        padding:8px 14px; border-radius:20px; font-size:13px;
    }
</style>
</head>
<body>
<header>
    <img src="img/mycup-sftrf.png" alt="Logo My Cup of T">
    <div class="header-text">
        <h1>Exercice 4 – Test final – Panne de carburant</h1>
        <h2>Drag &amp; drop, correction à la fin, score et redémarrage aléatoire</h2>
    </div>
</header>

<main>
    <h3 class="section-title">Exercice 4 – Test final</h3>
    <div class="exercise">
        <p class="subtitle">
            Glissez les étiquettes de vocabulaire dans les bonnes phrases.
            Vous pouvez écouter chaque étiquette en anglais. La correction est affichée seulement à la fin.
        </p>

        <div id="dragPool" class="drag-pool">
            <!-- Les items seront générés par JavaScript pour permettre l’ordre aléatoire -->
        </div>

        <div class="questions" id="questions">
            <!-- FR → EN phrases -->
            <div class="drop-zone" data-answer="panne_essence">
                <span class="drop-label">Je suis en panne d’essence.</span>
                <span class="drop-content"></span>
            </div>
            <div class="drop-zone" data-answer="reservoir_vide">
                <span class="drop-label">Mon réservoir est vide.</span>
                <span class="drop-content"></span>
            </div>
            <div class="drop-zone" data-answer="voyant_allume">
                <span class="drop-label">Le voyant de carburant est allumé.</span>
                <span class="drop-content"></span>
            </div>
            <div class="drop-zone" data-answer="presque_plus">
                <span class="drop-label">Je n’ai presque plus de carburant.</span>
                <span class="drop-content"></span>
            </div>
            <div class="drop-zone" data-answer="station">
                <span class="drop-label">Je ne peux pas atteindre la prochaine station.</span>
                <span class="drop-content"></span>
            </div>
            <div class="drop-zone" data-answer="tunnel">
                <span class="drop-label">Je suis dans le tunnel du Mont-Blanc.</span>
                <span class="drop-content"></span>
            </div>
        </div>

        <button class="btn" onclick="gradeTest()">Corriger le test</button>
        <button class="btn secondary" onclick="resetTest()">Refaire le test (ordre aléatoire)</button>

        <div id="result" class="result-summary"></div>
        <div id="correction" class="correction-block" style="display:none;"></div>
    </div>

    <div class="nav-links">
        <a href="index.html">Retour à l'accueil</a>
    </div>
</main>

<script>
function speak(text){
    const utter=new SpeechSynthesisUtterance(text);
    utter.lang="en-GB";
    utter.rate=0.95;
    speechSynthesis.speak(utter);
}

// Banque d’items pour le test (clé = réponse attendue dans data-answer)
const itemsData = [
    {key:"panne_essence", label:"I’ve run out of petrol.", speak:"I’ve run out of petrol."},
    {key:"reservoir_vide", label:"My tank is empty.", speak:"My tank is empty."},
    {key:"voyant_allume", label:"The low fuel light is on.", speak:"The low fuel light is on."},
    {key:"presque_plus", label:"I’m almost out of fuel.", speak:"I’m almost out of fuel."},
    {key:"station", label:"I can’t reach the next service station.", speak:"I can’t reach the next service station."},
    {key:"tunnel", label:"I’m in the Mont Blanc tunnel.", speak:"I’m in the Mont Blanc tunnel."}
];

function shuffle(array){
    for(let i=array.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
    }
    return array;
}

function renderPool(){
    const pool=document.getElementById('dragPool');
    pool.innerHTML='';
    const shuffled=shuffle([...itemsData]);
    shuffled.forEach(item=>{
        const div=document.createElement('div');
        div.className='drag-item';
        div.draggable=true;
        div.id='item-'+item.key;
        div.dataset.key=item.key;

        const span=document.createElement('span');
        span.textContent=item.label;
        const btn=document.createElement('button');
        btn.textContent='▶';
        btn.onclick=()=>speak(item.speak);
        div.appendChild(span);
        div.appendChild(btn);

        div.addEventListener('dragstart',e=>{
            e.dataTransfer.setData('text/plain',div.id);
        });

        pool.appendChild(div);
    });
}

function initDrops(){
    const drops=document.querySelectorAll('.drop-zone');
    drops.forEach(zone=>{
        zone.addEventListener('dragover',e=>{
            e.preventDefault();
            zone.classList.add('over');
        });
        zone.addEventListener('dragleave',()=>{
            zone.classList.remove('over');
        });
        zone.addEventListener('drop',e=>{
            e.preventDefault();
            zone.classList.remove('over');
            const id=e.dataTransfer.getData('text/plain');
            const dragged=document.getElementById(id);
            if(!dragged) return;
            const content=zone.querySelector('.drop-content');
            if(content.firstChild){
                document.getElementById('dragPool').appendChild(content.firstChild);
            }
            content.textContent='';
            content.appendChild(dragged);
            zone.classList.remove('correct','wrong');
        });
    });
}

function gradeTest(){
    const drops=document.querySelectorAll('.drop-zone');
    let total=0;
    let correct=0;

    drops.forEach(zone=>{
        zone.classList.remove('correct','wrong');
        const ans=zone.dataset.answer;
        const content=zone.querySelector('.drop-content');
        const item=content.querySelector('.drag-item');
        if(item){
            total++;
            if(item.dataset.key===ans){
                correct++;
                zone.classList.add('correct');
            }else{
                zone.classList.add('wrong');
            }
        }else{
            total++;
            zone.classList.add('wrong');
        }
    });

    const percent=Math.round((correct/total)*100);
    const result=document.getElementById('result');
    result.innerHTML=`Score : <strong>${correct}/${total}</strong> soit <strong>${percent}%</strong>.`;

    // Correction détaillée
    const corr=document.getElementById('correction');
    let html="<strong>Correction :</strong><ul>";
    drops.forEach(zone=>{
        const ansKey=zone.dataset.answer;
        const ansItem=itemsData.find(i=>i.key===ansKey);
        const fr=zone.querySelector('.drop-label').textContent;
        html+=`<li>${fr} → <em>${ansItem ? ansItem.label : ''}</em></li>`;
    });
    html+="</ul>";
    corr.innerHTML=html;
    corr.style.display='block';
}

function resetTest(){
    const drops=document.querySelectorAll('.drop-zone');
    drops.forEach(zone=>{
        zone.classList.remove('correct','wrong','over');
        const content=zone.querySelector('.drop-content');
        const item=content.querySelector('.drag-item');
        if(item){
            document.getElementById('dragPool').appendChild(item);
        }
        content.textContent='';
    });
    document.getElementById('result').textContent='';
    document.getElementById('correction').style.display='none';
    renderPool(); // recrée les items dans un ordre aléatoire
    initDrops();
}

// init
renderPool();
initDrops();
</script>
</body>
</html>
